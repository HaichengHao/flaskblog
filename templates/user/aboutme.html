{% extends 'base.html' %}
{% block style %}
    {{ super() }}
{% endblock %}
{% block title %}
    å…³äºæˆ‘
{% endblock %}

{% block page_content %}
    {% if selfintro != None %}
        <div id="selfintro" style="padding: 20px">
            <div class="contentraw"
                 style="padding: 30px;background-color: #6f7a7d;color: whitesmoke;border-radius: 8px">
                {{ selfintro.selfintro }}

            </div>
            <button class="btn btn-success" style="margin-top: 8px" id="modifyintro">ä¿®æ”¹ç®€ä»‹</button>
        </div>
        <div id="newintro" style="padding: 30px;display: none">
            <form action="{{ url_for('user.mofyme') }}" method="post">
                <p>
                <textarea class="mytextarea" name="new_intro" id="content" cols="50" rows="10"
                          placeholder="ç•™ä¸‹ä½ çš„ä¸ªäººç®€ä»‹å§â¤ï¸â¤ï¸â¤ï¸" style="min-height: 70px">{{ selfintro.selfintro }}</textarea>
                </p>
                <p>
                    <input type="text" name="uid" value="{{ g.userme.id }}" hidden="hidden">
                </p>
                <p><input type="submit" value="å‘å¸ƒæ–°ç®€ä»‹" class="btn btn-primary"></p>
            </form>

        </div>
    {% else %}
        <div style="padding: 30px;">
            <p>
                è¿˜æ²¡æœ‰ç®€ä»‹å“¦ğŸ˜‰,å¿«æ¥ç•™ä¸‹ä½ çš„è¶³è¿¹!!ğŸ¤©
            </p>
        </div>
        <div class="" style="padding: 30px">
            <form action="{{ url_for('user.aboutme') }}" method="post">
                <p>
                <textarea class="mytextarea" name="selfintro_" id="content" cols="50" rows="10"
                          placeholder="ç•™ä¸‹ä½ çš„ä¸ªäººç®€ä»‹å§â¤ï¸â¤ï¸â¤ï¸" style="min-height: 70px"></textarea>
                </p>
                <p>
                    <input type="text" name="uid" value="{{ g.userme.id }}" hidden="hidden">
                </p>
                <p><input type="submit" value="å‘å¸ƒç®€ä»‹" class="btn btn-primary"></p>
            </form>

        </div>
    {% endif %}
{% endblock %}

{% block myjs %}
    {#    <script src="https://cdn.tiny.cloud/1/2bn27w2aq5v8rbes6ajcwfyj2h0agqlwk3l0psl7bn428fdd/tinymce/8/tinymce.min.js"#}
    {#            referrerpolicy="origin" crossorigin="anonymous"></script>#}
{#    <script src="{{ url_for('static', filename='tinymce/langs/zh_CN.js') }}"></script>#}
    <script src="{{ url_for('static',filename='js/publisharticle.js') }}"></script>
    <script src="{{ url_for('static', filename='tinymce/tinymce.min.js') }}"></script>
    <script>            tinymce.init({
        selector: '#content',
        height: 400,
        menubar: true,  // å¯ä»¥æ‰“å¼€èœå•æ æ–¹ä¾¿æµ‹è¯•ï¼ˆç”Ÿäº§å¯å…³ï¼‰
        toolbar: 'undo redo | blocks | bold italic | alignleft aligncenter alignright | bullist numlist',
        // æ³¨æ„è¿™é‡Œçš„ 'blocks' æŒ‰é’®ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸€ä¸ªä¸‹æ‹‰æ¡†ç”¨äºé€‰æ‹©æ®µè½ã€æ ‡é¢˜ç­‰
        blocks: 'blocks', // è¿™ä¸ªé…ç½®å®šä¹‰äº†ä¸‹æ‹‰æ¡†ä¸­æ˜¾ç¤ºçš„é€‰é¡¹
        block_formats: 'æ®µè½=p; ä¸€çº§æ ‡é¢˜=h1; äºŒçº§æ ‡é¢˜=h2; ä¸‰çº§æ ‡é¢˜=h3; é¢„æ ¼å¼åŒ–æ–‡æœ¬=pre; åœ°å€=address',
        // --- æ’ä»¶åˆ—è¡¨ï¼šç¡®ä¿åŒ…å«ä»¥ä¸‹æ’ä»¶ ---
        plugins: [
            'advlist',          // é«˜çº§åˆ—è¡¨
            'autolink',         // è‡ªåŠ¨é“¾æ¥
            'lists',            // åˆ—è¡¨
            'link',             // è¶…é“¾æ¥
            {#'image',            // å›¾ç‰‡ â† å…³é”®#}
            'charmap',
            'print',
            'preview',
            'anchor',
            'searchreplace',
            'visualblocks',
            'code',             // æ˜¾ç¤ºæºç æŒ‰é’®
            'codesample',       // æ’å…¥ä»£ç å— â† æ–°å¢
            'insertdatetime',
            {#'media',            // è§†é¢‘åµŒå…¥ï¼ˆYouTubeç­‰ï¼‰#}
            'table',            // è¡¨æ ¼ â† ç¡®ä¿æœ‰
            'paste',            // ç²˜è´´å¤„ç†
            {#'help',#}
            'wordcount'
        ],

        // --- å·¥å…·æ ï¼šåŠ å…¥å›¾ç‰‡ã€è¡¨æ ¼ã€ä»£ç æŒ‰é’® ---
    {#    toolbar: `#}
    {#    undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify |#}
    {#    bullist numlist outdent indent | table tabledelete | link image media codesample |#}
    {#    code | help#}
    {#`,#}

        // --- ä¸­æ–‡æ”¯æŒ ---
        language: 'zh_CN',
        language_url: '{{ url_for("static", filename="tinymce/langs/zh_CN.js") }}',

        // --- å…¶ä»–ä¼˜åŒ– ---
        branding: false,
        promotion: false,
        license_key: 'gpl',

        // --- å›¾ç‰‡ç²˜è´´å’Œä¸Šä¼ å…³é”®é…ç½® ---
        paste_data_images: true,              // å…è®¸ç²˜è´´å›¾ç‰‡ï¼ˆå¦‚ä»å¾®ä¿¡ã€æˆªå›¾è½¯ä»¶ç›´æ¥ Ctrl+Vï¼‰
        images_upload_handler: function (blobInfo, success, failure) {
            // è¿™é‡Œæ˜¯ä¸Šä¼ å›¾ç‰‡çš„æ ¸å¿ƒé€»è¾‘
            uploadImage(blobInfo, success, failure);
        },
        automatic_uploads: false,             // æ‰‹åŠ¨æ§åˆ¶ä¸Šä¼ 
    });</script>
    <script>

        $(document).ready(function () {
            selfintro = document.getElementById('selfintro');
            newintro = document.getElementById('newintro');
            $('.contentraw').each(function () {
                let $div = $(this);
                let text = $div.text().trim(); // è·å–æ–‡æœ¬å†…å®¹ï¼ˆè‡ªåŠ¨è§£ç  HTML å®ä½“ï¼‰

                // å»æ‰é¦–å°¾çš„åŒå¼•å·æˆ–å•å¼•å·
                //important:è¿™é‡Œç”¨çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å¼€å¤´å’Œç»“å°¾çš„å•å¼•å·å’ŒåŒå¼•å·,åˆšå¥½èƒ½è®©è¢«å¼•å·åŒ…å«çš„HTMLæ ‡ç­¾ç”Ÿæ•ˆ
                let cleaned = text.replace(/^["']|["']$/g, '');

                // è®¾ç½®ä¸º HTMLï¼ˆå› ä¸ºå†…å®¹æ˜¯ HTML æ ‡ç­¾ï¼‰
                $div.html(cleaned);
            });
            $('#modifyintro').click(
                function () {
                    selfintro.style.display = "none";
                    newintro.style.display = 'block';
                }
            )
        });

    </script>
{% endblock %}