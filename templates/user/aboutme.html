{% extends 'base.html' %}
{% block style %}
    {{ super() }}
{% endblock %}
{% block title %}
    å…³äºæˆ‘
{% endblock %}

{% block page_content %}
    {% if selfintro != None %}
        <div id="selfintro" style="padding: 20px">
            <div class="contentraw"
                 style="padding: 30px;background-color: #6f7a7d;color: whitesmoke;border-radius: 8px">
                {{ selfintro.selfintro }}

            </div>
            <button class="btn btn-success"  style="margin-top: 8px" id="modifyintro">ä¿®æ”¹ç®€ä»‹</button>
        </div>
        <div id="newintro" style="padding: 30px;display: none" >
            <form action="{{ url_for('user.mofyme') }}" method="post">
                <p>
                <textarea class="mytextarea" name="new_intro" id="content" cols="50" rows="10"
                          placeholder="ç•™ä¸‹ä½ çš„ä¸ªäººç®€ä»‹å§â¤ï¸â¤ï¸â¤ï¸" style="min-height: 70px">{{ selfintro.selfintro }}</textarea>
                </p>
                <p>
                    <input type="text" name="uid" value="{{ g.userme.id }}" hidden="hidden">
                </p>
                <p><input type="submit" value="å‘å¸ƒæ–°ç®€ä»‹" class="btn btn-primary"></p>
            </form>

        </div>
    {% else %}
        <div style="padding: 30px;">
            <p>
                è¿˜æ²¡æœ‰ç®€ä»‹å“¦ğŸ˜‰,å¿«æ¥ç•™ä¸‹ä½ çš„è¶³è¿¹!!ğŸ¤©
            </p>
        </div>
        <div class="" style="padding: 30px">
            <form action="{{ url_for('user.aboutme') }}" method="post">
                <p>
                <textarea class="mytextarea" name="selfintro_" id="content" cols="50" rows="10"
                          placeholder="ç•™ä¸‹ä½ çš„ä¸ªäººç®€ä»‹å§â¤ï¸â¤ï¸â¤ï¸" style="min-height: 70px"></textarea>
                </p>
                <p>
                    <input type="text" name="uid" value="{{ g.userme.id }}" hidden="hidden">
                </p>
                <p><input type="submit" value="å‘å¸ƒç®€ä»‹" class="btn btn-primary"></p>
            </form>

        </div>
    {% endif %}
{% endblock %}

{% block myjs %}
    <script src="https://cdn.tiny.cloud/1/2bn27w2aq5v8rbes6ajcwfyj2h0agqlwk3l0psl7bn428fdd/tinymce/8/tinymce.min.js"
            referrerpolicy="origin" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='tinymce/langs/zh_CN.js') }}"></script>
    <script src="{{ url_for('static',filename='js/publisharticle.js') }}"></script>
    <script>

        $(document).ready(function () {
            selfintro = document.getElementById('selfintro');
            newintro = document.getElementById('newintro');
            $('.contentraw').each(function () {
                let $div = $(this);
                let text = $div.text().trim(); // è·å–æ–‡æœ¬å†…å®¹ï¼ˆè‡ªåŠ¨è§£ç  HTML å®ä½“ï¼‰

                // å»æ‰é¦–å°¾çš„åŒå¼•å·æˆ–å•å¼•å·
                //important:è¿™é‡Œç”¨çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å¼€å¤´å’Œç»“å°¾çš„å•å¼•å·å’ŒåŒå¼•å·,åˆšå¥½èƒ½è®©è¢«å¼•å·åŒ…å«çš„HTMLæ ‡ç­¾ç”Ÿæ•ˆ
                let cleaned = text.replace(/^["']|["']$/g, '');

                // è®¾ç½®ä¸º HTMLï¼ˆå› ä¸ºå†…å®¹æ˜¯ HTML æ ‡ç­¾ï¼‰
                $div.html(cleaned);
            });
            $('#modifyintro').click(
                function (){
                    selfintro.style.display = "none";
                    newintro.style.display = 'block';
                }
            )
        });

    </script>
{% endblock %}