{% extends 'base.html' %}
{% block title %}
    æ–‡ç« è¯¦æƒ…é¡µ
{% endblock %}

{% block style %}
    {{ super() }}
{% endblock %}

{% block page_content %}
    <div class="container" style="padding: 20px">
        <div class="card w-95 mb-3" style="padding: 7px;margin-top: 15px;overflow: hidden">
            <p>å‘å¸ƒæ—¶é—´:{{ article.pdatetime }}&nbsp;&nbsp;æ‰€å±ç±»åˆ«:{{ article.article_type.typename }}</p>
            <p><i class="bi bi-check-circle" id="click_"></i>ç‚¹å‡»é‡:{{ article.click_num }} &nbsp;&nbsp;
                <i class="bi bi-star" id="star"></i>æ”¶è—é‡:{{ article.save_num }}&nbsp;
                <i class="bi bi-hand-thumbs-up" id="loveit"></i><span id="love-count">ç‚¹èµé‡:{{ article.love_num }}</span></p>
            <p>ä½œè€…:{{ article.user.username }}&nbsp;&nbsp</p>
            {#            <h3 style="color: #30423b"><a href="{{ url_for("article.detail") }}?article_id={{ article.id }}">{{ article.title }}</a></h3>#}
            <h3>{{ article.title }}</h3>
            <div class="contentraw">
                {{ article.content }}
            </div>
        </div>
        <hr>
    <h4>è¯„è®ºğŸ’¬:</h4>
    {% if g.userme %}
        <div>
            <form action="{{ url_for('article.addcomment') }}" method="post">
                <input type="hidden" name="articleid" value="{{ article.id }}"> <!--åšä¸€ä¸ªéšè—çš„è¡¨å•åŸŸæ¥ä¼ é€’æ–‡ç« id-->
                <p>
                    <textarea name="mycomment" id="myc" cols="40" rows="5" placeholder="ç•™ä¸‹ä½ çš„ç²¾å½©è¯„è®ºğŸ¤©"></textarea>
                </p>
                <button type="button" id="subbtn" class="btn btn-success"
                        onclick="document.getElementById('submitcomm').click()">å‘å¸ƒ</button>
                <p><input type="submit" id="submitcomm" style="display: none"></p>
            </form>
        </div>
        {% else %}
        <div style="margin-bottom: 8px">
            <a href="{{ url_for('user.login') }}" class="btn btn-primary">ç‚¹æˆ‘ç™»å½•åå³å¯å‘è¡¨è¯„è®ºğŸ˜‰</a>
        </div>
    {% endif %}
    <div style="background-color: #646f7a;padding: 20px;border-radius: 4px">
    {% if pagination.items %}
        {% for comm in pagination.items %}
            <div style="background-color:#ffffff;padding: 5px;border-radius: 4px; margin-bottom:6px;">
                <img src="{% if comm.user.icon %}{{ url_for('static',filename=comm.user.icon) }}{% else %}{{ url_for('static',filename='imgs/touxiang.png') }}{% endif %}" style="border-radius: 100%;width: 40px;height: 40px ; margin-right: 10px">
                <p><span>ç”¨æˆ·å:{{ comm.user.username }}</span>&nbsp;&nbsp;<span>{{ comm.cdatetime }}</span></p>
                <p>è¯„è®ºå†…å®¹:<br>{{ comm }}</p>
            </div>
        {% endfor %}
    {% else %}
        <div style="background-color:#ffffff;padding: 5px;border-radius: 4px; height: 60px">
            <h4>æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘!!!ğŸ˜‰</h4></div>
        </div>
    {% endif %}
    </div>
    {% if pagination.items %}
    <nav aria-label="Page navigation example" class="col-md-6 offset-md-5">
            <ul class="pagination">
                <li class="page-item">
                    <a class="page-link" {% if pagination.has_prev %}
                       href="{{ url_for('article.detail') }}?page={{ pagination.prev_num }}&article_id={{article.id}}"{% else %}href="{{ url_for('article.detail') }}?page=1&article_id={{article.id}}{% endif %}"
                       aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% for p in range(1,pagination.pages + 1) %}
                    <!--important:pagination.pageè·å–å½“å‰æ‰€åœ¨é¡µ,å¦‚æœå½“å‰æ‰€åœ¨é¡µå’Œå¯¹åº”çš„pé¡µç æ•°ä¸€æ ·ï¼Œé‚£å°±æ˜¾ç¤ºæ¿€æ´»çŠ¶æ€-->
                    <li {% if pagination.page == p %} class=" page-item active"{% else %}
                                                      class="page-item"  {% endif %}><a class="page-link"
                                                                                        href="{{ url_for('article.detail') }}?page={{ p }}&article_id={{article.id}}">{{ p }}</a>
                    </li>
                {% endfor %}

                <a class="page-link" {% if pagination.has_next %}
                   href="{{ url_for('article.detail') }}?page={{ pagination.next_num }}&article_id={{article.id}}"
                   {% else %}href="{{ url_for('article.detail') }}?page=1&article_id={{article.id}}"{% endif %} aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
                </li>
            </ul>
        </nav>
        {% else %}
        <div></div>
    {% endif %}
    </div>
{% endblock %}

{% block myjs %}
    {{ super() }}

    <script>
        /*å¤„ç†çš„æ˜¯å¯Œæ–‡æœ¬æ–‡æ¡£çš„æ˜¾ç¤º*/
        $(document).ready(function () {
            $('.contentraw').each(function () {
                let $div = $(this);
                let text = $div.text().trim(); // è·å–æ–‡æœ¬å†…å®¹ï¼ˆè‡ªåŠ¨è§£ç  HTML å®ä½“ï¼‰

                // å»æ‰é¦–å°¾çš„åŒå¼•å·æˆ–å•å¼•å·
                //important:è¿™é‡Œç”¨çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å¼€å¤´å’Œç»“å°¾çš„å•å¼•å·å’ŒåŒå¼•å·,åˆšå¥½èƒ½è®©è¢«å¼•å·åŒ…å«çš„HTMLæ ‡ç­¾ç”Ÿæ•ˆ
                let cleaned = text.replace(/^["']|["']$/g, '');

                // è®¾ç½®ä¸º HTMLï¼ˆå› ä¸ºå†…å®¹æ˜¯ HTML æ ‡ç­¾ï¼‰
                $div.html(cleaned);
            });



            /*ä¸‹é¢å¤„ç†çš„æ˜¯å„ä¸ªæ–‡å­—å›¾æ ‡çš„çŠ¶æ€*/

            $('#click_').hover(function (){
                 $(this).toggleClass('bi-check-circle bi-check-circle-fill text-success')
            }

            );
            $('#star').hover(function () {
                // åœ¨é¼ æ ‡æ‚¬åœæ—¶åˆ‡æ¢åˆ° 'bi-star-fill' å’Œ 'text-danger'
                $(this).toggleClass('bi-star bi-star-fill text-success');
            });
            $('#loveit').hover(
                function (){
                    $(this).toggleClass('bi-hand-thumbs-up bi-hand-thumbs-up-fill text-danger')
                }
            );

            /*ç‚¹èµçš„å®ç°*/
            $('#loveit').click(function (e){
                e.preventDefault();
                $.get('{{ url_for('article.love') }}',{artid:{{article.id}}},function (data){
                    if(data.success){
                        $('#love-count').text('ç‚¹èµé‡:'+data.num)
                        $('#loveit').toggleClass('bi-hand-thumbs-up bi-hand-thumbs-up-fill text-danger')
                    }

                }).fail(function (){
                    alert('ç‚¹èµå¤±è´¥,è¯·ç™»å½•åé‡æ–°å°è¯•')
                })
            })

        });


    </script>
{% endblock %}